<!--header-->
<nav class="navbar">
    <div class="nav-container">
        <a href="/" class="nav-logo">
            <span class="o">&nbsp;O</span><span class="fertio">fertio</span>
        </a>
        
        <% if (isAuthenticated) { %>            
            <!-- Menú para usuarios LOGUEADOS -->
            <ul id="user-menu" class="nav-menu">
                <li class="nav-item">
                    <a href="/" class="nav-link">LOGUEADO: <%= user.email %></a>
                </li>
                <li class="nav-item">
                    <a href="/" class="nav-link">Inicio</a>
                </li>
                <li class="nav-item">                    
                    <a href="/user/mi-oferta" class="nav-link">Mi Oferta</a>
                </li>                
                <li class="nav-item">
                    <a href="#cerrar" class="nav-link" onclick="handleLogout(); return false;">Cerrar Sesión</a>
                </li>
            </ul>
        <% } else { %>
            <!-- Menú para usuarios NO logueados (GUEST) -->
            <ul id="guest-menu" class="nav-menu">
                <li class="nav-item">
                    <a href="/" class="nav-link">Inicio</a>
                </li>
                <li class="nav-item">
                    <a href="/user/login" class="nav-link">Iniciar sesión</a>
                </li>
                <!--li class="nav-item">
                    <a href="/register" class="nav-link">Registrarse</a>
                </li-->
                <li class="nav-item">
                    <a href="/about" class="nav-link">Acerca de</a>
                </li>
            </ul>
        <% } %>
        
        <div class="hamburger">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </div>
    </div>
</nav>

<script>
    // Función para toggle del menú móvil
    const hamburger = document.querySelector('.hamburger');
    const navMenu = document.querySelector('.nav-menu');

    hamburger.addEventListener('click', () => {
        hamburger.classList.toggle('active');
        navMenu.classList.toggle('active');
    });

    // Cerrar menú al hacer click en un enlace (móviles)
    document.querySelectorAll('.nav-link').forEach(n => n.addEventListener('click', () => {
        hamburger.classList.remove('active');
        navMenu.classList.remove('active');
    }));

    // Cerrar menú al hacer scroll (móviles)
    window.addEventListener('scroll', () => {
        if (navMenu.classList.contains('active')) {
            hamburger.classList.remove('active');
            navMenu.classList.remove('active');
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        <% if (isAuthenticated) { %>
            console.log('Usuario autenticado:', '<%= user.email %>');
        <% } else { %>
            console.log('Usuario no autenticado');
        <% } %>
    });

    // Función de logout mejorada
    async function handleLogout() {
        try {
            const response = await fetch('/user/logout', {
                method: 'POST',
                credentials: 'include'
            });

            if (response.ok) {
                console.log('Sesión cerrada exitosamente');
                window.location.href = '/';
            } else {
                console.log('Error en respuesta del servidor');
                // Forzar redirección de todas formas
                window.location.href = '/';
            }
        } catch (error) {
            console.log('Error cerrando sesión:', error);
            // Forzar redirección incluso si hay error
            window.location.href = '/';
        }
    }
</script>
<!--/header-->